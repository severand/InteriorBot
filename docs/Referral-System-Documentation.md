# üìö –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê - –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

**–ü—Ä–æ–µ–∫—Ç:** InteriorBot  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/severand/InteriorBot  
**–î–∞—Ç–∞:** 03.12.2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0

---

## üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è Telegram-–±–æ—Ç–∞ —Å:

‚úÖ **–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ–º –¥—Ä—É–∑–µ–π** –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º** –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Ç –ø–æ–∫—É–ø–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤  
‚úÖ **–í—ã–≤–æ–¥–æ–º –¥–µ–Ω–µ–≥** –Ω–∞ –∫–∞—Ä—Ç—ã/–°–ë–ü/YooMoney/–¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã  
‚úÖ **–û–±–º–µ–Ω–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞** –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏  
‚úÖ **–ü–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π** (–∑–∞—Ä–∞–±–æ—Ç–∫–∏, –æ–±–º–µ–Ω—ã, –≤—ã–ø–ª–∞—Ç—ã)

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã](#—Å—Ö–µ–º–∞-—Ä–∞–±–æ—Ç—ã)
4. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
5. [API –º–µ—Ç–æ–¥—ã](#api-–º–µ—Ç–æ–¥—ã)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
7. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
8. [FAQ](#faq)

---

## üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
InteriorBot/
‚îî‚îÄ‚îÄ bot/
    ‚îú‚îÄ‚îÄ config.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (BOT_USERNAME)
    ‚îú‚îÄ‚îÄ main.py                      # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
    ‚îú‚îÄ‚îÄ database/
    ‚îÇ   ‚îú‚îÄ‚îÄ models.py                # SQL-—Å—Ö–µ–º—ã –∏ –∑–∞–ø—Ä–æ—Å—ã
    ‚îÇ   ‚îî‚îÄ‚îÄ db.py                    # –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –ë–î
    ‚îú‚îÄ‚îÄ handlers/
    ‚îÇ   ‚îú‚îÄ‚îÄ user_start.py            # –ü—Ä–æ—Ñ–∏–ª—å + —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ
    ‚îÇ   ‚îú‚îÄ‚îÄ payment.py               # –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ % –æ—Ç –ø–æ–∫—É–ø–æ–∫
    ‚îÇ   ‚îî‚îÄ‚îÄ referral.py              # –í—ã–ø–ª–∞—Ç—ã, –æ–±–º–µ–Ω—ã, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –∏—Å—Ç–æ—Ä–∏—è
    ‚îú‚îÄ‚îÄ keyboards/
    ‚îÇ   ‚îî‚îÄ‚îÄ inline.py                # –ö–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
    ‚îú‚îÄ‚îÄ states/
    ‚îÇ   ‚îî‚îÄ‚îÄ fsm.py                   # ReferralStates
    ‚îî‚îÄ‚îÄ utils/
        ‚îú‚îÄ‚îÄ navigation.py            # edit_menu, show_main_menu
        ‚îî‚îÄ‚îÄ texts.py                 # –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|-------------|
| **database/models.py** | 5 —Ç–∞–±–ª–∏—Ü –ë–î + –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã |
| **database/db.py** | 25+ –º–µ—Ç–æ–¥–æ–≤ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏ |
| **handlers/referral.py** | –ü–æ–ª–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–≤—ã–ø–ª–∞—Ç—ã, –æ–±–º–µ–Ω—ã, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã) |
| **handlers/user_start.py** | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ. —Å—Å—ã–ª–æ–∫ + –ø—Ä–æ—Ñ–∏–ª—å |
| **handlers/payment.py** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π |
| **keyboards/inline.py** | 4 –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π |
| **states/fsm.py** | 6 —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è FSM |

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### 1. –¢–∞–±–ª–∏—Ü–∞ `users` (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:
```sql
user_id INTEGER PRIMARY KEY
username TEXT
balance INTEGER DEFAULT 3
reg_date DATETIME DEFAULT CURRENT_TIMESTAMP
```

#### –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:
```sql
referral_code TEXT UNIQUE                -- —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ (8 —Å–∏–º–≤–æ–ª–æ–≤)
referred_by INTEGER                      -- ID —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
referrals_count INTEGER DEFAULT 0        -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö
```

#### –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–ª—è:
```sql
referral_balance INTEGER DEFAULT 0       -- –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö
referral_total_earned INTEGER DEFAULT 0  -- –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ
referral_total_paid INTEGER DEFAULT 0    -- –≤—Å–µ–≥–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ
```

#### –†–µ–∫–≤–∏–∑–∏—Ç—ã:
```sql
payment_method TEXT                      -- card/sbp/yoomoney/other
payment_details TEXT                     -- –Ω–æ–º–µ—Ä/—Ç–µ–ª–µ—Ñ–æ–Ω/–∫–æ—à–µ–ª—ë–∫
sbp_bank TEXT                            -- –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–Ω–∫–∞ –¥–ª—è –°–ë–ü
```

---

### 2. –¢–∞–±–ª–∏—Ü–∞ `referral_earnings`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–∏

```sql
CREATE TABLE referral_earnings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    referrer_id INTEGER NOT NULL,        -- –∫—Ç–æ –ø–æ–ª—É—á–∏–ª
    referred_id INTEGER NOT NULL,        -- –∫—Ç–æ –∫—É–ø–∏–ª
    payment_id TEXT NOT NULL,            -- ID –ø–ª–∞—Ç–µ–∂–∞
    amount INTEGER NOT NULL,             -- —Å—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏
    commission_percent INTEGER NOT NULL, -- –ø—Ä–æ—Ü–µ–Ω—Ç (10%)
    earnings INTEGER NOT NULL,           -- –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Ä—É–±.
    tokens_given INTEGER NOT NULL,       -- –±–æ–Ω—É—Å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    status TEXT DEFAULT 'credited',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
)
```

**–ü—Ä–∏–º–µ—Ä:**
- –†–µ—Ñ–µ—Ä–∞–ª –∫—É–ø–∏–ª –ø–∞–∫–µ—Ç –∑–∞ 990 —Ä—É–±
- –†–µ—Ñ–µ—Ä–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç: 99 —Ä—É–± (10%) + 3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

---

### 3. –¢–∞–±–ª–∏—Ü–∞ `referral_exchanges`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–æ–≤ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```sql
CREATE TABLE referral_exchanges (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    amount INTEGER NOT NULL,          -- —Å—É–º–º–∞ –æ–±–º–µ–Ω–∞ (—Ä—É–±.)
    tokens INTEGER NOT NULL,          -- –ø–æ–ª—É—á–µ–Ω–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    exchange_rate INTEGER NOT NULL,   -- –∫—É—Ä—Å (29 —Ä—É–±/–≥–µ–Ω)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
)
```

---

### 4. –¢–∞–±–ª–∏—Ü–∞ `referral_payouts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–ø–ª–∞—Ç—É

```sql
CREATE TABLE referral_payouts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    amount INTEGER NOT NULL,
    payment_method TEXT,              -- card/sbp/yoomoney/other
    payment_details TEXT,
    status TEXT DEFAULT 'pending',    -- pending/completed/rejected
    admin_note TEXT,
    requested_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    processed_at DATETIME,
    processed_by INTEGER
)
```

---

### 5. –¢–∞–±–ª–∏—Ü–∞ `settings`

**–ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã:**

| –ö–ª—é—á | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|-------------|
| `welcome_bonus` | `"3"` | –ë–æ–Ω—É—Å –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| `referral_bonus_inviter` | `"2"` | –ë–æ–Ω—É—Å –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É |
| `referral_bonus_invited` | `"2"` | –ë–æ–Ω—É—Å –Ω–æ–≤–æ–º—É –æ—Ç —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ |
| `referral_enabled` | `"1"` | –í–∫–ª—é—á–µ–Ω–∞ –ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ |
| `referral_commission_percent` | `"10"` | –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –ø–æ–∫—É–ø–æ–∫ |
| `referral_min_payout` | `"500"` | –ú–∏–Ω–∏–º—É–º –≤—ã–≤–æ–¥–∞ (—Ä—É–±.) |
| `referral_exchange_rate` | `"29"` | –ö—É—Ä—Å –æ–±–º–µ–Ω–∞ (—Ä—É–±/–≥–µ–Ω) |

---

## üîÑ –°–•–ï–ú–ê –†–ê–ë–û–¢–´

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ

```
1. –†–µ—Ñ–µ—Ä–µ—Ä –∫–æ–ø–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É: t.me/InteriorBot?start=ref_ABC12345
2. –î—Ä—É–≥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí /start ref_ABC12345
3. –ë–æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ù–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å—ã –û–ë–û–ò–ú:
   - –†–µ—Ñ–µ—Ä–µ—Ä: +2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ù–æ–≤—ã–π: +2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

**–ö–æ–¥ –≤ user_start.py:**
```python
@router.message(F.text.startswith("/start"))
async def cmd_start(message: Message, state: FSMContext):
    # –ü–∞—Ä—Å–∏–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
    referrer_code = None
    if len(message.text.split()) > 1:
        args = message.text.split()[1]
        if args.startswith('ref_'):
            referrer_code = args.replace('ref_', '')
    
    # –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await db.create_user(user_id, username, referrer_code)
```

---

### 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—Ç –ø–æ–∫—É–ø–æ–∫

```
1. –†–µ—Ñ–µ—Ä–∞–ª –ø–æ–∫—É–ø–∞–µ—Ç –ø–∞–∫–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 60 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∑–∞ 990 —Ä—É–±)
2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
   - –†–µ—Ñ–µ—Ä–∞–ª –ø–æ–ª—É—á–∞–µ—Ç 60 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - –†–µ—Ñ–µ—Ä–µ—Ä—É –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è:
     a) 99 —Ä—É–± –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (10% –æ—Ç 990)
     b) 3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å (99 / 29 = 3)
3. –û–ø–µ—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ referral_earnings
```

**–ö–æ–¥ –≤ payment.py:**
```python
async def _process_referral_commission(user_id, payment_id, amount, tokens):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞
    enabled = await db.get_setting('referral_enabled')
    if str(enabled) != '1':
        return
    
    # 2. –ù–∞—Ö–æ–¥–∏–º —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
    user_data = await db.get_user_data(user_id)
    referrer_id = user_data.get('referred_by')
    if not referrer_id:
        return
    
    # 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é
    commission_percent = int(await db.get_setting('referral_commission_percent') or '10')
    earnings = int(amount * commission_percent / 100)
    
    # 4. –ù–∞—á–∏—Å–ª—è–µ–º —Ä—É–±–ª–∏
    await db.add_referral_balance(referrer_id, earnings)
    
    # 5. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    exchange_rate = int(await db.get_setting('referral_exchange_rate') or '29')
    tokens_to_give = earnings // exchange_rate
    
    if tokens_to_give > 0:
        await db.add_tokens(referrer_id, tokens_to_give)
    
    # 6. –õ–æ–≥–∏—Ä—É–µ–º
    await db.log_referral_earning(
        referrer_id, referred_id, payment_id, 
        amount, commission_percent, earnings, tokens_to_give
    )
```

---

### 3. –û–±–º–µ–Ω –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "üíé –û–±–º–µ–Ω—è—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
2. –í–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å –∏ –∫—É—Ä—Å: 290 —Ä—É–± = 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
3. –í–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–ª–∏ /all
4. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
```

**–ö–æ–¥ –≤ referral.py:**
```python
@router.message(ReferralStates.entering_exchange_amount)
async def process_exchange_amount(message: Message, state: FSMContext):
    tokens = int(message.text)  # –∏–ª–∏ /all
    cost = tokens * exchange_rate
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–º–µ–Ω
    await db.decrease_referral_balance(user_id, cost)
    await db.add_tokens(user_id, tokens)
    await db.log_referral_exchange(user_id, cost, tokens, exchange_rate)
```

---

### 4. –ó–∞–ø—Ä–æ—Å –≤—ã–ø–ª–∞—Ç—ã

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "üí∏ –í—ã–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏"
2. –ü—Ä–æ–≤–µ—Ä–∫–∏:
   - –ú–∏–Ω–∏–º—É–º ‚â• 500 —Ä—É–±
   - –†–µ–∫–≤–∏–∑–∏—Ç—ã —É–∫–∞–∑–∞–Ω—ã
3. –í–≤–æ–¥–∏—Ç —Å—É–º–º—É –∏–ª–∏ /all
4. –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—è–≤–∫–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "pending"
5. –ë–∞–ª–∞–Ω—Å –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è
```

---

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–ø–æ—Å–æ–±—ã:**

| –°–ø–æ—Å–æ–± | payment_method | –§–æ—Ä–º–∞—Ç | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|--------|---------------|---------|------------|
| –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ | `card` | 16-19 —Ü–∏—Ñ—Ä | 16-19 —Ü–∏—Ñ—Ä |
| –°–ë–ü | `sbp` | +7XXXXXXXXXX | 12 —Å–∏–º–≤–æ–ª–æ–≤ |
| YooMoney | `yoomoney` | 11-15 —Ü–∏—Ñ—Ä | 11-15 —Ü–∏—Ñ—Ä |
| –î—Ä—É–≥–æ–π | `other` | –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π | –ú–∏–Ω. 5 —Å–∏–º–≤–æ–ª–æ–≤ |

---

## üé® –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–°

### –ü—Ä–æ—Ñ–∏–ª—å —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

```
üë§ –í–ê–® –ü–†–û–§–ò–õ–¨

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üéØ –ë–∞–ª–∞–Ω—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–π: 15
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

üéÅ –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞:
üîó –í–∞—à–∞ —Å—Å—ã–ª–∫–∞: t.me/InteriorBot?start=ref_ABC12345
üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: 5 –¥—Ä—É–∑–µ–π

üí∞ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:
‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–æ: 1 250 —Ä—É–±.
‚Ä¢ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: 2 500 —Ä—É–±.
‚Ä¢ –í—ã–ø–ª–∞—á–µ–Ω–æ: 1 000 —Ä—É–±.

üéØ –í–∞—à–∏ —É—Å–ª–æ–≤–∏—è:
‚Ä¢ –ó–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é: +2 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚Ä¢ % –æ—Ç –ø–æ–∫—É–ø–æ–∫: 10%
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

### –ö–Ω–æ–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è

```
[üí≥ –ö—É–ø–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏]
[üí∏ –í—ã–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏] [üíé –û–±–º–µ–Ω—è—Ç—å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏]
[‚öôÔ∏è –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –≤—ã–ø–ª–∞—Ç]
[üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π]
[üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
```

---

## üîå API –ú–ï–¢–û–î–´

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã (db.py)

**–°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```python
# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await db.create_user(user_id, username, referrer_code=None)

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = await db.get_user_data(user_id)

# –ü–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–º—É –∫–æ–¥—É
referrer = await db.get_user_by_referral_code("ABC12345")
```

**–†–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º:**
```python
# –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
balance = await db.get_referral_balance(user_id)
await db.add_referral_balance(user_id, 99)
await db.decrease_referral_balance(user_id, 500)

# –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏
balance = await db.get_balance(user_id)
await db.add_tokens(user_id, 10)
await db.decrease_balance(user_id)  # -1
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –ó–∞—Ä–∞–±–æ—Ç–æ–∫
await db.log_referral_earning(
    referrer_id, referred_id, payment_id,
    amount, commission_percent, earnings, tokens
)

# –û–±–º–µ–Ω
await db.log_referral_exchange(
    user_id, amount, tokens, exchange_rate
)

# –í—ã–ø–ª–∞—Ç–∞
payout_id = await db.create_payout_request(
    user_id, amount, method, details
)
```

**–ò—Å—Ç–æ—Ä–∏—è:**
```python
earnings = await db.get_user_referral_earnings(user_id, limit=5)
exchanges = await db.get_user_exchanges(user_id, limit=5)
payouts = await db.get_user_payouts(user_id, limit=5)
```

**–†–µ–∫–≤–∏–∑–∏—Ç—ã:**
```python
await db.set_payment_details(user_id, "sbp", "+79991234567")
details = await db.get_payment_details(user_id)
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
```python
value = await db.get_setting("referral_commission_percent")
await db.set_setting("referral_commission_percent", "15")
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### config.py

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ:**
```python
class Config:
    BOT_USERNAME = os.getenv('BOT_USERNAME', 'InteriorBot')  # –ë–ï–ó @
```

**–î–æ–±–∞–≤—å—Ç–µ –≤ .env:**
```env
BOT_USERNAME=InteriorBot
```

**–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏:**
```python
bot_username = config.BOT_USERNAME.replace('@', '')
referral_link = f"t.me/{bot_username}?start=ref_{referral_code}"
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
- [ ] –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π referral_code
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ –¥–æ–±–∞–≤–ª—è–µ—Ç +2 –æ–±–æ–∏–º
- [ ] referred_by –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è
- [ ] referrals_count —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è

**–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç –ø–æ–∫—É–ø–æ–∫:**
- [ ] –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `_process_referral_commission()`
- [ ] –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è 10%
- [ ] –†—É–±–ª–∏ –Ω–∞ referral_balance
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞ balance
- [ ] –ó–∞–ø–∏—Å—å –≤ referral_earnings

**–û–±–º–µ–Ω:**
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º
- [ ] –ë–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è
- [ ] /all –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç –≤—Å—ë

**–í—ã–≤–æ–¥:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º—É–º–∞ (500 —Ä—É–±)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—è–≤–∫–∞
- [ ] –ë–∞–ª–∞–Ω—Å –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è

**–†–µ–∫–≤–∏–∑–∏—Ç—ã:**
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—Ä—Ç—ã (16-19 —Ü–∏—Ñ—Ä)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+7XXXXXXXXXX)
- [ ] –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏

---

## üêõ –û–¢–õ–ê–î–ö–ê

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:**
```python
logger.info(f"[REFERRAL] –†–∞—Å—á–µ—Ç: {amount} * {percent}% = {earnings} —Ä—É–±")
logger.info(f"[REFERRAL] –ù–∞—á–∏—Å–ª–µ–Ω–æ {earnings} —Ä—É–± —Ä–µ—Ñ–µ—Ä–µ—Ä—É {referrer_id}")
logger.info(f"[REFERRAL] ‚úÖ –ó–∞–ø–∏—Å—å –≤ referral_earnings —Å–æ–∑–¥–∞–Ω–∞")
```

**–ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º:**
```bash
# –í—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
grep "[REFERRAL]" bot.log

# –û—à–∏–±–∫–∏
grep "Failed to process referral" bot.log
```

### SQL-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏
SELECT user_id, username, referrals_count, referral_balance
FROM users WHERE referrals_count > 0;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
SELECT * FROM referral_earnings 
ORDER BY created_at DESC LIMIT 10;

-- –û–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–ª–∞—Ç—ã
SELECT u.username, p.amount, p.requested_at
FROM referral_payouts p
JOIN users u ON p.user_id = u.user_id
WHERE p.status = 'pending';
```

---

## ‚ùì FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç?**  
A: –î–∞. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ settings:
```python
await db.set_setting("referral_commission_percent", "15")
```

**Q: –ö–∞–∫ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—ã–≤–æ–¥ –¥–æ N —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤?**  
A: –í `request_payout()` –¥–æ–±–∞–≤—å—Ç–µ:
```python
if referrals_count < 5:
    await callback.answer("‚ö†Ô∏è –ú–∏–Ω–∏–º—É–º 5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤")
    return
```

**Q: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É?**  
A: –î–æ–±–∞–≤—å—Ç–µ `referrer_level_2` –≤ users. –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞.

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- [x] 5 —Ç–∞–±–ª–∏—Ü –ë–î
- [x] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users
- [x] 7 –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ settings
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- [x] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ % –æ—Ç –ø–æ–∫—É–ø–æ–∫
- [x] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä—É–±–ª–µ–π –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] –û–±–º–µ–Ω –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [x] –ó–∞–ø—Ä–æ—Å –≤—ã–ø–ª–∞—Ç—ã
- [x] 4 —Å–ø–æ—Å–æ–±–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- [x] –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
- [x] –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] –ü—Ä–æ—Ñ–∏–ª—å —Å —Ä–µ—Ñ. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- [x] 4 –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
- [x] FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üéì –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!**

‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å 5 —Ç–∞–±–ª–∏—Ü–∞–º–∏  
‚úÖ 25+ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã  
‚úÖ –ü–æ–ª–Ω—ã–π UI —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ %  
‚úÖ –í—ã–≤–æ–¥ –¥–µ–Ω–µ–≥ 4 —Å–ø–æ—Å–æ–±–∞–º–∏  
‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ–±–º–µ–Ω  
‚úÖ –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏  
‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  

**–ì–æ—Ç–æ–≤–æ –∫ production –∏ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è!**

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞: 03.12.2025*  
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: 1.0.0*  
*–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/severand/InteriorBot*
